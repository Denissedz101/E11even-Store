{% load static %}
{% load form_tags %}
{% load widget_tweaks %}


<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<title>Registro - E11even Store</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
		<link rel="stylesheet" href="{% static 'css/estilos-registro.css' %}">
	</head>
	
	<body class="d-flex flex-column min-vh-100">
		
		<!-- Top Bar -->
		<div class="top-bar">
			<div class="contact-info">
				<i class="bi bi-envelope me-2"></i>
				<span>Contacto_E11ven@gmail.com</span>
				<i class="bi bi-geo-alt ms-4 me-2"></i>
				<span>Los Leones 143, Providencia, Regi√≥n Metropolitana | Chile</span>
			</div>
			<div class="social-icons">
				<a href="https://www.facebook.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" width="30">
				</a>
				<a href="https://www.twitter.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/124/124021.png" width="30">
				</a>
				<a href="https://www.instagram.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/1409/1409946.png" width="30">
				</a>
			</div>
		</div>
		
		<!-- Main Content -->
		<div class="main-content flex-grow-1">
			<div class="header-container">
				<div class="logo">
					<img src="{% static 'img/logo11Store.png' %}" alt="Logo de la tienda">
				</div>
				<div class="nav-menu">
					<ul>
						<li><a href="{% url 'inicio' %}">üè† Inicio</a></li>
						<li><a href="{% url 'menu_categorias' %}">‚â£ Categor√≠as</a></li>
						<li><a href="{% url 'carro_compras' %}">üõí Carrito</a></li>
						<li><a href="{% url 'contacto' %}">‚úâ Contacto</a></li>
						<li><a href="{% url 'inicio_sesion' %}"><span class="registro-link">Ingresa a tu cuenta</span></a></li>
						<li><a href="{% url 'formulario_registro' %}" class="login-btn">Reg√≠strate</a></li>
					</ul>
					
				</div>
			</div>
			
			<!-- Registro -->
			<div class="container">
				<div id="container-formulario" class="mx-auto mt-4" style="max-width: 700px; background-color: rgba(221, 172, 243, 0.65); padding: 20px; width: 50vw; border: 1px solid red; border-radius: 15px;">
					<h2>Formulario de Registro</h2>
					
					<form method="POST" id="registroForm" novalidate>
						{% csrf_token %}
						<div class="mb-3">
							{{ form.usuario.label_tag }}
							{{ form.usuario|add_attr:"id:usuario,placeholder:Ingrese su usuario,class:form-control" }}
							<small class="text-danger" id="errorUsuario"></small>
						</div>
						
						<div class="mb-3">
							{{ form.nombre.label_tag }}
							{{ form.nombre|add_attr:"id:nombre,placeholder:Ingrese su nombre,class:form-control" }}
							<small class="text-danger" id="errorNombre"></small>
						</div>
						
						<div class="mb-3">
							{{ form.apellidos.label_tag }}
							{{ form.apellidos|add_attr:"id:apellidos,placeholder:Ingrese sus apellidos,class:form-control" }}
							<small class="text-danger" id="errorApellidos"></small>
						</div>
						
						<div class="mb-3">
							{{ form.rut.label_tag }}
							{{ form.rut|add_attr:"id:rut,placeholder:12345678-9,class:form-control" }}
							<small class="text-danger" id="errorRut"></small>
						</div>
						
						<div class="mb-3">
							{{ form.email.label_tag }}
							{{ form.email|add_attr:"id:email,placeholder:correo@email.com,class:form-control" }}
							<small class="text-danger" id="errorEmail"></small>
						</div>
						
						<div class="mb-3">
							{{ form.clave.label_tag }}
							{{ form.clave|add_attr:"id:clave,placeholder:Debe tener al menos una may√∫scula un n√∫mero y entre 6 y 18 caracteres,class:form-control" }}
							<small class="text-danger" id="errorClave"></small>
						</div>
						
						<div class="mb-3">
							{{ form.repetirClave.label_tag }}
							{{ form.repetirClave|add_attr:"id:repetirClave,placeholder:Repita su contrase√±a,class:form-control" }}
							<small class="text-danger" id="errorRepetirClave"></small>
						</div>
						
						<div class="mb-3">
							{{ form.fechaNacimiento.label_tag }}
							{{ form.fechaNacimiento|add_attr:"id:fechaNacimiento,class:form-control" }}
							<small class="text-danger" id="errorFechaNacimiento"></small>
						</div>
						
						<div class="mb-3">
							{{ form.direccion.label_tag }}
							{{ form.direccion|add_attr:"id:direccion,placeholder:Ingresa tu direcci√≥n (Opcional),class:form-control" }}
						</div>
						
						<!-- Botones -->
						<div class="mb-3">
							<button type="button" class="btn btn-outline-secondary" onclick="mostrarContrasena()">
								<i class="bi bi-eye"></i>
							</button>
							<button type="submit" class="btn btn-primary">Registrarse</button>
							<button type="reset" class="btn btn-secondary">Limpiar</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- Bootstrap -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
		
		
		<!-- Validaci√≥n -->
		<script>
			window.addEventListener('DOMContentLoaded', function () {
				const campos = [
				{
					id: "usuario",
					validar: val => val.trim() !== "",
					error: "Este campo no puede estar vac√≠o."
				},
				{
					id: "nombre",
					validar: val => val.trim() !== "",
					error: "Este campo no puede estar vac√≠o."
				},
				{
					id: "apellidos",
					validar: val => val.trim() !== "",
					error: "Este campo no puede estar vac√≠o."
				},
				{
					id: "rut",
					validar: val => /^[0-9]{7,8}-[0-9Kk]$/.test(val),
					error: "El RUT debe ingresarse sin puntos y con gui√≥n (ej. 12345678-9)."
				},
				{
					id: "email",
					validar: val => /^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(val),
					error: "Ingrese un correo electr√≥nico v√°lido."
				},
				{
					id: "clave",
					validar: val => /(?=.*\d)(?=.*[A-Z]).{6,18}/.test(val),
					error: "Debe tener al menos una may√∫scula, un n√∫mero y entre 6 y 18 caracteres."
				},
				{
					id: "repetirClave",
					validar: val => val === document.getElementById("clave").value,
					error: "Las contrase√±as no coinciden."
				},
				{
					id: "fechaNacimiento",
					validar: val => val !== "",
					error: "Debe ingresar su fecha de nacimiento."
				}
				];
				
				const btnRegistrar = document.querySelector('button[type="submit"]');
				
				function verificarCamposCompletos() {
					const todosCompletos = campos.every(campo => {
						const valor = document.getElementById(campo.id).value.trim();
						return valor !== "";
					});
					btnRegistrar.disabled = !todosCompletos;
				}
				
				campos.forEach(campo => {
					const input = document.getElementById(campo.id);
					input.addEventListener("input", () => {
						verificarCamposCompletos();
						
						const valor = input.value.trim();
						if (campo.validar(valor)) {
							input.classList.remove("is-invalid");
							input.classList.add("is-valid");
							} else {
							input.classList.remove("is-valid");
							input.classList.add("is-invalid");
						}
					});
				});
				
				document.getElementById("registroForm").addEventListener("submit", function (e) {
					e.preventDefault();
					let formularioValido = true;
					
					campos.forEach(campo => {
						const input = document.getElementById(campo.id);
						const errorEl = document.getElementById("error" + campo.id.charAt(0).toUpperCase() + campo.id.slice(1));
						const valor = input.value.trim();
						
						if (!campo.validar(valor)) {
							errorEl.innerText = campo.error;
							input.classList.remove("is-valid");
							input.classList.add("is-invalid");
							formularioValido = false;
							} else {
							errorEl.innerText = "";
							input.classList.remove("is-invalid");
							input.classList.add("is-valid");
						}
					});
					
					if (formularioValido) {
						alert("¬°Registro exitoso!");
					}
					
					
					// Activar o desactivar el bot√≥n de registro desde el principio
					verificarCamposCompletos();
				});
			});
		</script>
		
		<!-- FOOTER -->
		<footer>
			<p class="footer-text">¬© 2025 E11even Store. Todos los derechos reservados.</p>
		</footer>
		
	</body>
</html>
