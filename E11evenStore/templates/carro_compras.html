<!-- CARRO COMPRAS  -->
{% load static %}
<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<title>Carro de compras</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
		<link rel="stylesheet" href="{% static 'css/estilos-Carrito.css' %}"> 
	</head>
	
	<body class="d-flex flex-column min-vh-100">
		
		<div class="top-bar">
			<div class="contact-info">
				<i class="bi bi-envelope me-2"></i>
				<span>Contacto_E11ven@gmail.com</span>
				<i class="bi bi-geo-alt ms-4 me-2"></i>
				<span> Los Leones 143, Providencia, Region Metropolitana | Chile</span>
			</div>
			
			<div class="social-icons">
				<a href="https://www.facebook.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" alt="Facebook" width="30">
				</a>
				<a href="https://www.twitter.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/124/124021.png" alt="Twitter" width="30">
				</a>
				<a href="https://www.instagram.com/e11even_store" target="_blank">
					<img src="https://cdn-icons-png.flaticon.com/512/1409/1409946.png" alt="Instagram" width="30">
				</a>
			</div>
		</div>
		
		<div class="main-content flex-grow-1">
			
			<div class="header-container">
				<div class="logo">
					<img src="{% static 'img/logo11Store.png' %}" alt="Logo de la tienda">
				</div>
				
				<div class="nav-menu">
					<ul>
						<li><a href="{% url 'inicio' %}">🏠 Inicio</a></li>
						<li><a href="{% url 'menu_categorias' %}">≣ Categorías</a></li>
						<li><a href="{% url 'carro_compras' %}">🛒 Carrito</a></li>
						<li><a href="{% url 'contacto' %}">✉ Contacto</a></li>
						<li><a href="{% url 'inicio_sesion' %}">🔐 Iniciar sesión</a></li>
						<li><a href="{% url 'formulario_registro' %}" class="login-btn">Registrate</a></li>
					</ul>
				</div>
			</div>
			
			<main class="container-fluid d-flex flex-column align-items-center" style="flex: 1;">
				<div id="carrito-container" class="mx-auto mt-4" style="max-width: 700px; background-color: rgba(198, 129, 230, 0.65); padding: 20px; border-radius: 15px;">
					{% if cliente %}
					<h4>¡Hola, {{ cliente.nombre }}! 🛍️ Aquí está tu carrito:</h4>
					{% endif %}
					
					<h3 class="mb-4">🛒 Carrito de Compras</h3>
					
					{% if productos_carro %}
					<ul class="list-group mb-4">
						{% for item in productos_carro %}
						<li class="list-group-item d-flex justify-content-between align-items-center">
							{{ item.producto.nombre }} (x{{ item.cantidad }})
							<span>
								${{ item.subtotal }}
								<form method="post" class="d-inline ms-3">
									{% csrf_token %}
									<input type="hidden" name="eliminar_producto" value="{{ item.producto.id }}">
									<button type="submit" class="btn btn-sm btn-danger">🗑️</button>
								</form>
						</span>
					</li>
					{% endfor %}
					<li class="list-group-item d-flex justify-content-between align-items-center fw-bold">
						Envío
						<span>$3990</span>
					</li>
					<li class="list-group-item d-flex justify-content-between align-items-center fw-bold">
						Total a pagar
						<span>${{ total }}</span>
					</li>
				</ul>
				
				{% if cliente_logeado %}
				<form method="post">
					{% csrf_token %}
					<div class="mb-3">
						{{ form_direccion.as_p }}
					</div>
					<div class="mb-3">
						{{ form_pago.as_p }}
					</div>
					<button type="submit" class="btn btn-success w-100">✅ Confirmar compra</button>
				</form>
				
				<!-- Botón para vaciar carrito con confirmación -->
				<form method="post" class="mt-3" onsubmit="return confirm('¿Estás segura/o de que quieres vaciar el carrito?')">
					{% csrf_token %}
					<input type="hidden" name="vaciar_carro" value="1">
					<button type="submit" class="btn btn-warning w-100">🧹 Vaciar carrito</button>
				</form>
				{% else %}
				<div class="alert alert-warning text-center mt-3">
					Para completar tu compra, debes <a href="{% url 'inicio_sesion' %}">iniciar sesión</a> o <a href="{% url 'formulario_registro' %}">registrarte</a>.
				</div>
				{% endif %}
				
				{% else %}
				<div class="alert alert-info text-center">
					Tu carrito está vacío 🛒
				</div>
				{% endif %}
			</div>
			
			<!-- mensaje de compra -->
			<div class="container text-center mt-5" id="mensaje-compra">
				<h2>¡Gracias por tu compra!</h2>
				<p><strong>Número de compra:</strong> {{ compra.numero_compra }}</p>
				<p><strong>Dirección de envío:</strong> {{ compra.direccion_envio }}</p>
				<p><strong>Método de pago:</strong> {{ compra.metodo_pago }}</p>
				<p><strong>Productos:</strong></p>
				<ul>
					{% for detalle in compra.detalles.all %}
					<li>{{ detalle.producto.nombre }} (x{{ detalle.cantidad }})</li>
					{% endfor %}
				</ul>
				<p><strong>Total pagado:</strong> ${{ total }}</p>
				<a href="{% url 'inicio' %}" class="btn btn-primary mt-3">Volver al inicio</a>
			</div>
		</div>
	</body>
	<footer class="mt-auto text-center py-3">
		<p class="footer-text">&copy; 2025 Store E11even - Todos los derechos reservados</p>
	</footer>
</html>					